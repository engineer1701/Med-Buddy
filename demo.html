<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Med Buddy ¬∑ Complete Healthcare System</title>
  <!-- ALL FONTS + Chart.js + Font Awesome -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ===== RESET ===== */
    *{ margin:0; padding:0; box-sizing:border-box; }

    /* ===== BASE BODY STYLE ===== */
    body{
      height:100vh;
      overflow:hidden;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364,#6a11cb,#2575fc,#00f2fe);
      background-size:500% 500%;
      animation:bgFlow 20s ease infinite;
      font-family:'Poppins',sans-serif;
      color:white;
    }
    @keyframes bgFlow{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    /* ===== GLOBAL ANIMATIONS ===== */
    @keyframes fadeIn{to{opacity:1;}}
    @keyframes titleReveal{
      from{opacity:0;letter-spacing:14px;}
      to{opacity:1;letter-spacing:2px;}
    }

    /* ===== SPARKLES ===== */
    .sparkle{
      position:absolute;
      width:6px;height:6px;
      background:white;
      border-radius:50%;
      opacity:.8;
      animation:spark 6s linear infinite;
      z-index:1;
    }
    @keyframes spark{
      from{transform:translateY(0) scale(1);}
      to{transform:translateY(-120vh) scale(0);}
    }

    /* ===== MEDICINE FLOW ===== */
    .medicine{
      position:absolute;
      font-size:24px;
      opacity:0.85;
      animation:medicineFlow linear infinite;
      z-index:1;
      pointer-events:none;
    }
    @keyframes medicineFlow{
      from{transform:translate(var(--x),var(--y)) rotate(0deg);}
      to{transform:translate(0,0) rotate(360deg);}
    }

    /* ===== FLOATING ORBS ===== */
    .orb{
      position:absolute;
      width:220px;height:220px;
      border-radius:50%;
      filter:blur(90px);
      animation:float 10s ease-in-out infinite;
      z-index:0;
    }
    .orb.one{background:#00f2fe;top:10%;left:10%;}
    .orb.two{background:#f093fb;bottom:10%;right:15%;}
    .orb.three{background:#43e97b;top:20%;right:25%;}
    @keyframes float{
      0%,100%{transform:translateY(0);}
      50%{transform:translateY(-40px);}
    }

    /* ===== TAB NAVIGATION ===== */
    .tab-nav {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      display: flex;
      gap: 15px;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      padding: 12px 25px;
      border-radius: 50px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .tab-btn {
      padding: 8px 25px;
      border: none;
      border-radius: 30px;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
      font-size: 1rem;
      cursor: pointer;
      background: rgba(255,255,255,0.15);
      color: white;
      transition: 0.3s;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .tab-btn.active {
      background: #00f2fe;
      color: #0f2027;
      box-shadow: 0 0 20px #00f2fe;
    }
    .tab-btn:hover { background: rgba(255,255,255,0.3); }

    /* ===== SIDE MENU BUTTON ===== */
    .side-menu-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 10000;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      cursor: pointer;
      transition: 0.3s;
    }
    .side-menu-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }

    /* ===== SIDE MENU ===== */
    .side-menu {
      position: fixed;
      top: 80px;
      left: 20px;
      z-index: 10000;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transform: translateX(-100px);
      opacity: 0;
      transition: 0.3s;
      pointer-events: none;
    }
    .side-menu.active {
      transform: translateX(0);
      opacity: 1;
      pointer-events: all;
    }
    .menu-item {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      cursor: pointer;
      transition: 0.3s;
    }
    .menu-item:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }
    .menu-item.contacts { background: #43e97b; color: #000; }
    .menu-item.ai { background: #3498db; }
    .menu-item.records { background: #f39c12; }
    .menu-item.info { background: #9b59b6; }

    /* ===== PAGE CONTAINERS ===== */
    .page {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 10;
    }
    .page.active {
      opacity: 1;
      visibility: visible;
      z-index: 100;
    }

    /* ===== INTRO PAGE STYLES ===== */
    .intro-page { display: flex; justify-content: center; align-items: center; }
    .intro-container{ text-align:center; color:white; position:relative; z-index:10; width:100%; padding:20px; }
    .intro-quote{ font-size:1.1rem; opacity:0; margin-bottom:40px; animation:fadeIn 2s ease forwards; }
    .intro-logo{ margin:0 auto; width:110px; height:110px; border-radius:50%; background:radial-gradient(circle,#ffffff,#a1ffce,#00f2fe); display:flex; justify-content:center; align-items:center; font-size:44px; box-shadow:0 0 50px rgba(255,255,255,.9); animation:logoPath 6s ease-in-out forwards; }
    @keyframes logoPath{
      0%{transform:translate(0,0);}
      20%{transform:translate(-280px,-180px);}
      40%{transform:translate(280px,-180px);}
      60%{transform:translate(280px,180px);}
      80%{transform:translate(-280px,180px);}
      100%{transform:translate(0,0);}
    }
    .intro-heading-wrap{ position:relative; margin-top:140px; display:inline-block; }
    .intro-wing{ position:absolute; top:50%; width:180px; height:90px; background:radial-gradient(ellipse at center,rgba(255,255,255,.9),transparent 70%); filter:blur(2px); animation:wingGlow 4s ease-in-out infinite; }
    .intro-wing.left{ left:-190px; transform:translateY(-50%) rotate(-8deg); border-radius:0 100% 100% 0; }
    .intro-wing.right{ right:-190px; transform:translateY(-50%) rotate(8deg); border-radius:100% 0 0 100%; }
    @keyframes wingGlow{ 0%,100%{opacity:.6;} 50%{opacity:1;} }
    .intro-hand{ position:absolute; top:65%; width:120px; height:50px; background:radial-gradient(circle at right, #fff, rgba(255,255,255,0.3)); filter:blur(1.5px); opacity:0; animation:handAppear 2s ease forwards; animation-delay:4.5s; }
    .intro-hand.left{ left:-140px; border-radius:0 60px 60px 0; }
    .intro-hand.right{ right:-140px; border-radius:60px 0 0 60px; transform:scaleX(-1); }
    @keyframes handAppear{ from{opacity:0; transform:translateY(20px);} to{opacity:0.9; transform:translateY(0);} }
    .intro-heading{ font-family:'Playfair Display',serif; font-size:3.6rem; letter-spacing:2px; opacity:0; animation:titleReveal 3s ease forwards; animation-delay:3s; }
    .intro-tagline{ margin-top:20px; font-size:1.2rem; opacity:0; animation:fadeIn 2s ease forwards; animation-delay:6s; }

    /* ===== LOGIN PAGE STYLES ===== */
    .login-page { display: flex; justify-content: center; align-items: center; }
    .login-container{ position:relative; z-index:10; text-align:center; width:100%; padding:20px; }
    .login-orbit{ width:240px; height:240px; border-radius:50%; margin:auto; position:relative; animation:rotate 18s linear infinite; }
    @keyframes rotate{ from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
    .login-orbit span{ position:absolute; font-size:22px; }
    .login-orbit span:nth-child(1){top:-12px; left:50%;}
    .login-orbit span:nth-child(2){right:-12px; top:50%;}
    .login-orbit span:nth-child(3){bottom:-12px; left:50%;}
    .login-orbit span:nth-child(4){left:-12px; top:50%;}
    .login-profile{ width:130px; height:130px; border-radius:50%; background:radial-gradient(circle,#ffffff,#a1ffce,#00f2fe); display:flex; justify-content:center; align-items:center; font-size:54px; box-shadow:0 0 45px rgba(255,255,255,.9); margin:-190px auto 35px; }
    .login-form{ display:flex; flex-direction:column; align-items:center; }
    .login-input{ width:280px; padding:14px; margin:8px 0; border-radius:25px; border:none; outline:none; font-size:1rem; }
    .login-btn{ width:280px; padding:14px; margin-top:14px; border:none; border-radius:25px; background:#43e97b; color:#000; font-size:1rem; cursor:pointer; transition:0.3s; }
    .login-btn:hover{ transform:scale(1.05); }
    .login-register{ margin-top:14px; font-size:0.9rem; opacity:0.85; }
    .login-register span{ color:#00f2fe; cursor:pointer; font-weight:500; }

    /* ===== CONTACTS PAGE ===== */
    .contacts-page { display: flex; justify-content: center; align-items: center; }
    .contacts-container {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      text-align: center;
    }
    .contacts-container h2 { margin-bottom: 20px; font-family: 'Playfair Display', serif; }
    .contact-list {
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    .contact-item {
      background: rgba(255,255,255,0.2);
      margin: 10px 0;
      padding: 12px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .contact-item button {
      background: #ff4d4d;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      color: white;
    }
    .add-contact select {
      padding: 12px;
      border-radius: 8px;
      border: none;
      outline: none;
      width: 100%;
      margin: 5px 0;
      background: rgba(255,255,255,0.9);
    }
    .add-contact option {
      background: #333;
      color: white;
    }
    #customGateway {
      margin-top: 5px;
    }
    .add-contact {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }
    .add-contact input {
      padding: 12px;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    .add-contact button {
      background: #43e97b;
      color: #000;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    /* ===== AI CHATBOT PAGE ===== */
    .ai-page { display: flex; justify-content: center; align-items: center; }
    .ai-container {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      height: 80vh;
      display: flex;
      flex-direction: column;
    }
    .ai-header {
      text-align: center;
      margin-bottom: 20px;
      font-family: 'Playfair Display', serif;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .message {
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
    }
    .message.user {
      align-items: flex-end;
    }
    .message.bot {
      align-items: flex-start;
    }
    .message-content {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 15px;
      background: rgba(255,255,255,0.2);
      color: white;
    }
    .message.user .message-content {
      background: #00f2fe;
      color: #000;
    }
    .chat-input-area {
      display: flex;
      gap: 10px;
    }
    .chat-input-area input {
      flex: 1;
      padding: 12px;
      border-radius: 25px;
      border: none;
      outline: none;
      background: rgba(255,255,255,0.9);
    }
    .chat-input-area button {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      background: #00f2fe;
      color: #000;
      cursor: pointer;
      font-weight: bold;
    }
    .message.bot .message-content.thinking {
      background: rgba(255,255,255,0.3);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    /* ===== RECORDS PAGE ===== */
    .records-page { display: flex; justify-content: center; align-items: center; }
    .records-container {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 800px;
      text-align: center;
    }
    .records-container h2 { margin-bottom: 20px; font-family: 'Playfair Display', serif; }
    .record-tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .record-tab {
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.3s;
    }
    .record-tab.active {
      background: #00f2fe;
      color: #000;
    }
    .record-section {
      display: none;
    }
    .record-section.active {
      display: block;
    }
    .medicine-details {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    .medicine-record {
      background: rgba(255,255,255,0.2);
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      text-align: left;
    }
    .chart-container {
      height: 300px;
      margin: 20px 0;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    /* ===== INFORMATION PAGE ===== */
    .info-page { display: flex; justify-content: center; align-items: center; }
    .info-container {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      text-align: center;
    }
    .info-container h2 { margin-bottom: 20px; font-family: 'Playfair Display', serif; }
    .doctor-info {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .info-input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    .prescription-upload {
      margin: 20px 0;
    }
    .prescription-upload input {
      display: none;
    }
    .prescription-upload label {
      display: inline-block;
      padding: 12px 25px;
      background: #3498db;
      border-radius: 25px;
      cursor: pointer;
    }
    .extracted-meds {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      text-align: left;
    }
    .save-info-btn {
      background: #43e97b;
      color: #000;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 20px;
    }
    
    /* New styles for prescription extraction */
    .prescription-preview {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    .prescription-preview h4 {
      color: #00f2fe;
      margin-bottom: 15px;
    }
    .doctor-details-box {
      background: rgba(52, 152, 219, 0.15);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .date-box {
      background: rgba(155, 89, 182, 0.15);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .medicines-box {
      background: rgba(46, 204, 113, 0.15);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .med-item {
      background: rgba(255,255,255,0.1);
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #2ecc71;
    }
    .confirm-btn {
      width: 100%;
      padding: 15px;
      background: #43e97b;
      color: #000;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 15px;
    }
    .prescriptions-history {
      margin: 20px 0;
      max-height: 400px;
      overflow-y: auto;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
    }
    .prescription-card {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    /* ===== DASHBOARD PAGE ===== */
    .dashboard-page { overflow-y: auto; }
    .dashboard-container{ max-width:1100px; margin:auto; padding:80px 20px 30px; text-align:center; }
    .dashboard-heading{ font-family:'Playfair Display',serif; font-size:3.2rem; letter-spacing:2px; margin-bottom:20px; animation:titleReveal 2s ease forwards; }

    .dashboard-top-actions{
      display:flex;
      flex-wrap: wrap;
      justify-content:center;
      gap:12px;
      margin:20px 0 35px;
    }
    .dashboard-top-actions button{
      padding:10px 18px;
      border:none;
      border-radius:25px;
      font-size:0.95rem;
      cursor:pointer;
      transition:0.3s;
      background: rgba(255,255,255,0.2);
      color: white;
      border:1px solid rgba(255,255,255,0.3);
    }
    .dashboard-elderly{ background:#43e97b !important; color:#000 !important; }
    .dashboard-sos{ background:#ff4d4d !important; color:white !important; box-shadow:0 0 15px rgba(255,77,77,.8); }
    .dashboard-voice{ background:#3498db !important; }
    .dashboard-clear{ background:#e74c3c !important; }
    .dashboard-top-actions button:hover{ transform:scale(1.08); }

    .dashboard-quote-box{
      min-height:70px;
      margin:25px 0 20px;
      display:flex;
      justify-content:center;
      align-items:center;
      text-align:center;
      font-size:1.3rem;
      font-weight:300;
    }

    .dashboard-medicine-section{
      background:rgba(255,255,255,0.12);
      backdrop-filter:blur(10px);
      border-radius:18px;
      padding:25px;
      box-shadow:0 0 25px rgba(0,0,0,.25);
      animation:fadeUp 1.5s ease forwards;
    }
    @keyframes fadeUp{ from{opacity:0; transform:translateY(40px);} to{opacity:1; transform:translateY(0);} }
    .dashboard-medicine-section h2{ font-size:1.8rem; margin-bottom:20px; }

    .progress-container {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      margin: 15px 0 20px;
      height: 20px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #43e97b, #00f2fe);
      border-radius: 20px;
      transition: width 0.5s ease-in-out;
    }
    #healthScore { margin: 5px 0; font-weight:300; }

    .dashboard-medicine-list{
      list-style:none;
      margin-bottom:25px;
    }
    .dashboard-medicine-list li{
      background:rgba(255,255,255,.18);
      margin:10px auto;
      padding:12px 18px;
      border-radius:12px;
      max-width:500px;
      animation:fadeIn 0.6s ease forwards;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .dashboard-medicine-list li input[type="checkbox"]{
      transform:scale(1.3);
      accent-color:#00f2fe;
    }
    .dashboard-add-btn{
      width:60px;
      height:60px;
      border-radius:50%;
      border:none;
      font-size:2rem;
      background:#00f2fe;
      color:#000;
      cursor:pointer;
      box-shadow:0 0 20px rgba(0,242,254,.9);
      transition:.3s;
    }
    .dashboard-add-btn:hover{ transform:rotate(90deg) scale(1.1); }

    .functional-inputs{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      margin:20px 0 10px;
    }
    .functional-inputs input{
      padding:12px 16px;
      border-radius:40px;
      border:none;
      outline:none;
      font-size:1rem;
      min-width:180px;
      background:rgba(255,255,255,0.9);
      color:#000;
    }
    .functional-inputs input::placeholder{ color:#333; }

    .elder-mode .dashboard-heading { font-size: 4rem; }
    .elder-mode li { font-size: 1.5rem; padding: 18px; }
    .elder-mode input, .elder-mode button { padding: 16px; font-size: 1.3rem; }

    .highlight { animation: glow 1.5s ease-in-out; }
    @keyframes glow {
      0% { box-shadow: 0 0 5px #4CAF50; }
      50% { box-shadow: 0 0 20px #4CAF50; }
      100% { box-shadow: 0 0 5px #4CAF50; }
    }

    @media (max-width:700px){
      .intro-heading{ font-size:2.5rem; }
      .intro-wing{ width:100px; height:50px; left:-100px; right:-100px; }
      .intro-hand{ width:80px; }
      .tab-nav { padding: 8px 15px; }
      .tab-btn { padding: 6px 15px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <!-- ORBS + SPARKLES + MEDICINE FLOW -->
  <div class="orb one"></div><div class="orb two"></div><div class="orb three"></div>

  <!-- SIDE MENU BUTTON -->
  <div class="side-menu-btn" onclick="toggleSideMenu()">
    <i class="fas fa-bars"></i>
  </div>

  <!-- SIDE MENU -->
  <div class="side-menu" id="sideMenu">
    <div class="menu-item contacts" onclick="switchPage('contacts', document.querySelectorAll('.tab-btn')[0]); toggleSideMenu()">
      <i class="fas fa-address-book"></i>
    </div>
    <div class="menu-item ai" onclick="switchPage('ai', document.querySelectorAll('.tab-btn')[0]); toggleSideMenu()">
      <i class="fas fa-robot"></i>
    </div>
    <div class="menu-item records" onclick="switchPage('records', document.querySelectorAll('.tab-btn')[0]); toggleSideMenu()">
      <i class="fas fa-chart-bar"></i>
    </div>
    <div class="menu-item info" onclick="switchPage('info', document.querySelectorAll('.tab-btn')[0]); toggleSideMenu()">
      <i class="fas fa-info-circle"></i>
    </div>
  </div>

  <!-- TAB NAVIGATION -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchPage('intro', this)">‚ú® Intro</button>
    <button class="tab-btn" onclick="switchPage('login', this)">üîê Login</button>
    <button class="tab-btn" onclick="switchPage('dashboard', this)">üìã Dashboard</button>
  </div>

  <!-- INTRO PAGE -->
  <div id="intro-page" class="page intro-page active">
    <div class="intro-container">
      <div class="intro-quote">‚ÄúWhere science meets compassion, healing begins.‚Äù</div>
      <div class="intro-logo">‚öïÔ∏è</div>
      <div class="intro-heading-wrap">
        <div class="intro-wing left"></div><div class="intro-wing right"></div>
        <div class="intro-hand left"></div><div class="intro-hand right"></div>
        <div class="intro-heading">MED BUDDY</div>
      </div>
      <div class="intro-tagline">Care That Never Misses a Dose</div>
    </div>
  </div>

  <!-- LOGIN PAGE -->
  <div id="login-page" class="page login-page">
    <div class="login-container">
      <div class="login-orbit"><span>üíä</span><span>üíâ</span><span>ü©∫</span><span>üß¨</span></div>
      <div class="login-profile">üë§</div>
      <div class="login-form">
        <input type="text" placeholder="Username" class="login-input" id="loginUsername">
        <input type="password" placeholder="Password" class="login-input" id="loginPassword">
        <button class="login-btn" id="loginButton">Login</button>
      </div>
      <div class="login-register">Don‚Äôt have an account? <span id="register-link">Register</span></div>
    </div>
  </div>

  <!-- CONTACTS PAGE -->
  <div id="contacts-page" class="page contacts-page">
      <div class="contacts-container">
          <h2>Emergency Contacts</h2>
          <div class="contact-list" id="contactList">
              <!-- Contacts will appear here -->
          </div>
          <div class="add-contact">
              <input type="text" id="contactName" placeholder="Contact Name">
              <input type="tel" id="contactNumber" placeholder="Phone Number (10 digits)">
              
              <select id="contactCarrier" onchange="toggleCustomGateway()">
                  <option value="">Select Carrier</option>
                  <option value="jio">üì± Jio (@jio.com)</option>
                  <option value="airtel">üì± Airtel (@airtelap.com)</option>
                  <option value="vi">üì± Vi (@vodaide.com)</option>
                  <option value="bsnl">üì± BSNL (@bsnl.in)</option>
                  <option value="idea">üì± Idea (@ideacellular.net)</option>
                  <option value="vodafone">üì± Vodafone (@vodafone.in)</option>
                  <option value="other">üîÑ Other (enter manually)</option>
              </select>
              
              <input type="text" id="customGateway" placeholder="Enter gateway (e.g., txt.att.net)" style="display: none;">
              
              <button onclick="addContact()">Add Contact</button>
          </div>
          <p style="font-size: 12px; margin-top: 10px; opacity: 0.7;">SOS will open WhatsApp for instant messaging</p>
      </div>
  </div>

  <!-- AI CHATBOT PAGE -->
  <div id="ai-page" class="page ai-page">
    <div class="ai-container">
      <div class="ai-header">
        <h2>üíä Med Buddy AI Assistant</h2>
        <p>Ask me anything about medicines, diseases, or health</p>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot">
          <div class="message-content">Hello! I'm your health assistant. How can I help you today?</div>
        </div>
      </div>
      <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="Type your question..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <!-- RECORDS PAGE -->
  <div id="records-page" class="page records-page">
    <div class="records-container">
      <h2>üìä Medicine Records</h2>
      <div class="record-tabs">
        <button class="record-tab active" onclick="showRecordTab('daily')">Daily</button>
        <button class="record-tab" onclick="showRecordTab('weekly')">Weekly</button>
      </div>
      
      <!-- Daily Records Section -->
      <div id="dailyRecords" class="record-section active">
        <h3>Today's Medicines</h3>
        <div class="medicine-details" id="dailyMedicineList"></div>
        <div class="chart-container">
          <canvas id="dailyChart"></canvas>
        </div>
      </div>
      
      <!-- Weekly Records Section -->
      <div id="weeklyRecords" class="record-section">
        <h3>Weekly Adherence</h3>
        <div class="medicine-details" id="weeklyMedicineList"></div>
        <div class="chart-container">
          <canvas id="weeklyRecordChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- INFORMATION PAGE - EXTRACT ALL FROM PRESCRIPTION -->
  <div id="info-page" class="page info-page">
    <div class="info-container">
      <h2>üìã Medical Information</h2>

      <!-- PRESCRIPTION SECTION - EXTRACT ALL DETAILS -->
      <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; margin: 20px 0;">
        <h3>üìÑ Upload Prescription</h3>
        
        <div style="background: rgba(0,0,0,0.2); border-radius: 10px; padding: 20px;">
          
          <div style="margin: 20px 0;">
            <input type="file" id="prescriptionUpload" accept="image/*,.pdf" style="display: none;">
            <button onclick="document.getElementById('prescriptionUpload').click();" style="width: 100%; padding: 15px; background: #3498db; color: white; border: none; border-radius: 10px; font-size: 1rem; cursor: pointer;">
              <i class="fas fa-upload"></i> Upload Prescription & Extract All Details
            </button>
          </div>

          <!-- Extracted Prescription Details Preview -->
          <div id="extractedPreview" style="display: none; margin-top: 20px;">
            <h4>üìã Extracted Prescription Details:</h4>
            
            <!-- Doctor Details -->
            <div style="background: rgba(52, 152, 219, 0.15); border-radius: 8px; padding: 15px; margin: 10px 0;">
              <h5 style="color: #3498db; margin-bottom: 10px;">üë®‚Äç‚öïÔ∏è Doctor Information</h5>
              <div id="extractedDoctorInfo" style="font-size: 0.95rem;"></div>
            </div>
            
            <!-- Prescription Date -->
            <div style="background: rgba(155, 89, 182, 0.15); border-radius: 8px; padding: 15px; margin: 10px 0;">
              <h5 style="color: #9b59b6; margin-bottom: 10px;">üìÖ Prescription Date</h5>
              <div id="extractedDateInfo" style="font-size: 0.95rem;"></div>
            </div>
            
            <!-- Medicines List -->
            <div style="background: rgba(46, 204, 113, 0.15); border-radius: 8px; padding: 15px; margin: 10px 0;">
              <h5 style="color: #2ecc71; margin-bottom: 10px;">üíä Prescribed Medicines</h5>
              <div id="extractedMedicinesList" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            
            <button onclick="confirmExtractedMeds()" style="width: 100%; padding: 15px; background: #43e97b; color: #000; border: none; border-radius: 10px; font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: 15px;">
              ‚úÖ Confirm & Add All to Schedule
            </button>
          </div>
        </div>
      </div>

      <!-- All Prescriptions History -->
      <div style="margin: 20px 0;">
        <h3>üìö All Prescriptions History</h3>
        <div id="prescriptionsList" style="max-height: 400px; overflow-y: auto; background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;"></div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD PAGE -->
  <div id="dashboard-page" class="page dashboard-page">
    <div class="dashboard-container" id="mainContainer">
      <div class="dashboard-heading">MED BUDDY</div>

      <div class="dashboard-top-actions">
        <button class="dashboard-elderly" id="elderBtn" onclick="toggleElderMode()">üëì Enable Elder Mode</button>
        <button class="dashboard-sos" id="sosBtn" onclick="sendWhatsAppSOS()">üì± WhatsApp SOS</button>
        <button class="dashboard-voice" onclick="startVoice()">üé§ Voice Add</button>
        <button class="dashboard-clear" onclick="clearAll()">üóë Clear All</button>
      </div>

      <div class="dashboard-quote-box" id="dashboard-quote"></div>

      <div class="functional-inputs">
        <input type="text" id="medName" placeholder="Medicine Name">
        <input type="text" id="medDosage" placeholder="Dosage (e.g., 500mg)">
        <input type="time" id="medTime">
      </div>

      <h3 id="healthScore">Today's Adherence: 0%</h3>
      <div class="progress-container">
        <div id="progressBar" class="progress-bar"></div>
      </div>

      <div class="dashboard-medicine-section">
        <h2>Your Medicines</h2>
        <ul class="dashboard-medicine-list" id="medList"></ul>
        <button class="dashboard-add-btn" onclick="addMedicine()">+</button>
      </div>

      <canvas id="weeklyChart" style="display:none;"></canvas>
    </div>
  </div>

  <script>
    // ========== SPARKLES & MEDICINE FLOW ==========
    for(let i=0;i<150;i++){ let s=document.createElement("div"); s.className="sparkle"; s.style.left=Math.random()*100+"vw"; s.style.top=Math.random()*100+"vh"; s.style.animationDuration=3+Math.random()*5+"s"; document.body.appendChild(s); }
    const meds=["üíä","üíâ","ü©∫","üß¨","üß™","‚ù§Ô∏è"];
    for(let i=0;i<70;i++){ const m=document.createElement("div"); m.className="medicine"; m.textContent=meds[Math.floor(Math.random()*meds.length)]; m.style.setProperty("--x",(Math.random()*2400-1200)+"px"); m.style.setProperty("--y",(Math.random()*2400-1200)+"px"); m.style.left="50%"; m.style.top="50%"; m.style.animationDuration=8+Math.random()*12+"s"; document.body.appendChild(m); }

    // ========== GLOBAL VARIABLES ==========
    let medList = [];
    let adherence = 0;
    let weeklyChartInstance = null;
    let dailyChartInstance = null;
    let weeklyRecordChartInstance = null;
    let chartVisible = false;
    let dashboardActive = false;
    let emergencyContacts = [];
    let prescriptions = [];

    // ========== SIDE MENU ==========
    function toggleSideMenu() {
      document.getElementById('sideMenu').classList.toggle('active');
    }

    // ========== LOAD SAVED DATA ==========
    window.onload = function () {
      // Load medicines
      const saved = localStorage.getItem("medicines");
      if (saved) { medList = JSON.parse(saved); updateMedList(); }
      
      // Load contacts
      const savedContacts = localStorage.getItem('emergencyContacts');
      if (savedContacts) {
        emergencyContacts = JSON.parse(savedContacts);
        displayContacts();
      }
      
      // Load prescriptions
      loadPrescriptions();
      
      loadWeeklyChart();
      if (document.getElementById('dashboard-page').classList.contains('active')) {
        dashboardActive = false; checkDashboardAndStart();
      }
    };

    // ========== UPDATED CONTACT MANAGEMENT WITH CARRIER ==========
    // Toggle custom gateway input
    function toggleCustomGateway() {
        const carrier = document.getElementById('contactCarrier').value;
        const customInput = document.getElementById('customGateway');
        customInput.style.display = carrier === 'other' ? 'block' : 'none';
    }

    // Add contact with carrier info
    function addContact() {
        const name = document.getElementById('contactName').value;
        const number = document.getElementById('contactNumber').value;
        const carrier = document.getElementById('contactCarrier').value;
        const customGateway = document.getElementById('customGateway').value;
        
        if (!name || !number || !carrier) {
            alert('Please fill all fields');
            return;
        }
        
        // Clean phone number (remove non-digits)
        const cleanNumber = number.replace(/[^0-9]/g, '');
        
        if (cleanNumber.length < 10) {
            alert('Please enter a valid 10-digit phone number');
            return;
        }
        
        // Get email gateway
        let gateway = '';
        switch(carrier) {
            case 'jio': gateway = '@jio.com'; break;
            case 'airtel': gateway = '@airtelap.com'; break;
            case 'vi': gateway = '@vodaide.com'; break;
            case 'bsnl': gateway = '@bsnl.in'; break;
            case 'idea': gateway = '@ideacellular.net'; break;
            case 'vodafone': gateway = '@vodafone.in'; break;
            case 'other': gateway = customGateway.startsWith('@') ? customGateway : '@' + customGateway; break;
            default: gateway = '';
        }
        
        // Create email address
        const emailAddress = cleanNumber + gateway;
        
        emergencyContacts.push({ 
            name, 
            number: cleanNumber,
            carrier,
            gateway,
            email: emailAddress
        });
        
        localStorage.setItem('emergencyContacts', JSON.stringify(emergencyContacts));
        displayContacts();
        
        // Clear inputs
        document.getElementById('contactName').value = '';
        document.getElementById('contactNumber').value = '';
        document.getElementById('contactCarrier').value = '';
        document.getElementById('customGateway').style.display = 'none';
        document.getElementById('customGateway').value = '';
    }

    // Display contacts with carrier info
    function displayContacts() {
        const contactList = document.getElementById('contactList');
        if (!contactList) return;
        
        contactList.innerHTML = '';
        emergencyContacts.forEach((contact, index) => {
            const div = document.createElement('div');
            div.className = 'contact-item';
            div.innerHTML = `
                <div style="flex: 1; text-align: left;">
                    <strong>${contact.name}</strong><br>
                    <small>${contact.number}</small><br>
                    <small style="opacity: 0.7;">${contact.email}</small>
                </div>
                <button onclick="removeContact(${index})"><i class="fas fa-times"></i></button>
            `;
            contactList.appendChild(div);
        });
    }

    function removeContact(index) {
        emergencyContacts.splice(index, 1);
        localStorage.setItem('emergencyContacts', JSON.stringify(emergencyContacts));
        displayContacts();
    }

    // ========== AI CHATBOT FUNCTIONS ==========
    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (!message) return;

        // Add user message
        addMessage(message, 'user');
        input.value = '';
        
        // Show typing indicator
        addMessage('ü§ñ Thinking...', 'bot');

        try {
            const API_KEY = 'AIzaSyDt7j_EtA10qZiRQ3c_YtcEjwEhSTtf64o';
            
            // USING GEMINI 2.0 FLASH (from your models list)
            const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `You are Med Buddy AI, a helpful healthcare assistant. 
                                   Provide accurate, helpful information about medicines, diseases, and health.
                                   Keep responses clear, friendly, and medically accurate.
                                   
                                   User question: ${message}`
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 800
                    }
                })
            });

            const data = await response.json();
            console.log("API Response:", data);
            
            // Remove thinking indicator
            document.querySelector('.message.bot:last-child').remove();
            
            // Get AI response
            if (data.candidates && data.candidates[0]?.content?.parts[0]?.text) {
                const aiResponse = data.candidates[0].content.parts[0].text;
                addMessage(aiResponse, 'bot');
            } else if (data.error) {
                addMessage(`Error: ${data.error.message}`, 'bot');
            } else {
                addMessage('Sorry, I could not generate a response.', 'bot');
            }
            
        } catch (error) {
            console.error('Gemini API error:', error);
            document.querySelector('.message.bot:last-child').remove();
            addMessage('Error: ' + error.message, 'bot');
        }
    }

    function addMessage(text, sender) {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;
        messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // ========== NEW WHATSAPP SOS FUNCTION ==========
    function sendWhatsAppSOS() {
        if (emergencyContacts.length === 0) {
            alert('‚ùå Please add emergency contacts first!');
            switchPage('contacts', document.querySelectorAll('.tab-btn')[0]);
            toggleSideMenu();
            return;
        }
        
        // Show status
        const sosBtn = document.getElementById('sosBtn');
        const originalText = sosBtn.textContent;
        sosBtn.textContent = 'üì± OPENING WHATSAPP...';
        sosBtn.disabled = true;
        
        try {
            // Get current time for message
            const timestamp = new Date().toLocaleString();
            
            // Create SOS message
            const message = encodeURIComponent(`üö® SOS EMERGENCY from Med Buddy!
            
I need immediate help!

‚è∞ Time: ${timestamp}

Please respond or call immediately. - From Med Buddy`);
            
            // Open WhatsApp for each contact
            let whatsappOpened = 0;
            
            emergencyContacts.forEach((contact) => {
                // Format number (remove any non-digits)
                const number = contact.number.replace(/[^0-9]/g, '');
                
                // Add country code if not present (assuming India +91)
                const fullNumber = number.length === 10 ? '91' + number : number;
                
                // Open WhatsApp web/app
                window.open(`https://wa.me/${fullNumber}?text=${message}`, '_blank');
                whatsappOpened++;
            });
            
            // Show success message
            alert(`‚úÖ WhatsApp opened for ${whatsappOpened} contact(s)!
            
1. WhatsApp will open in a new tab
2. Type any additional message if needed
3. Press Send button in WhatsApp
4. Your contacts will receive the SOS instantly!`);
            
            // Log the SOS
            saveSOSLog(emergencyContacts, message);
            
        } catch (error) {
            console.error('WhatsApp SOS Error:', error);
            alert('‚ùå Error opening WhatsApp. Please try again.');
        } finally {
            // Restore button
            sosBtn.textContent = originalText;
            sosBtn.disabled = false;
        }
    }

    // Log SOS for history
    function saveSOSLog(contacts, message) {
        const logs = JSON.parse(localStorage.getItem('sosLogs') || '[]');
        logs.push({
            timestamp: new Date().toISOString(),
            contacts: contacts.map(c => ({ name: c.name, number: c.number })),
            message: message.substring(0, 100) + '...'
        });
        localStorage.setItem('sosLogs', JSON.stringify(logs));
    }

    // ========== RECORDS MANAGEMENT ==========
    function showRecordTab(tab) {
        // Update tab buttons
        document.querySelectorAll('.record-tab').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Show corresponding section
        document.getElementById('dailyRecords').classList.remove('active');
        document.getElementById('weeklyRecords').classList.remove('active');
        
        if (tab === 'daily') {
            document.getElementById('dailyRecords').classList.add('active');
            loadDailyRecords();
        } else {
            document.getElementById('weeklyRecords').classList.add('active');
            loadWeeklyRecords();
        }
    }

    function loadDailyRecords() {
        // Display today's medicines
        const dailyList = document.getElementById('dailyMedicineList');
        const today = new Date().toDateString();
        
        let html = '<h4>Today - ' + today + '</h4>';
        
        // Sort medicines by time
        const sortedMeds = [...medList].sort((a, b) => {
            return a.time.localeCompare(b.time);
        });
        
        sortedMeds.forEach((med) => {
            const statusIcon = med.taken ? '‚úÖ' : '‚è∞';
            const statusText = med.taken ? 'Taken' : 'Pending';
            html += `
                <div class="medicine-record">
                    <strong>${med.name}</strong> ${med.dosage ? '(' + med.dosage + ')' : ''}<br>
                    Time: ${med.time}<br>
                    Status: ${statusIcon} ${statusText}
                </div>
            `;
        });
        
        if (medList.length === 0) {
            html += '<p>No medicines added for today</p>';
        }
        
        dailyList.innerHTML = html;
        
        // Create daily chart
        const ctx = document.getElementById('dailyChart').getContext('2d');
        if (dailyChartInstance) dailyChartInstance.destroy();
        
        // Group medicines by hour (ignoring minutes)
        const hourlyData = {};
        for (let hour = 0; hour < 24; hour++) {
            hourlyData[hour] = {
                total: 0,
                taken: 0
            };
        }
        
        medList.forEach(med => {
            const hour = parseInt(med.time.split(':')[0]);
            if (!isNaN(hour) && hour >= 0 && hour < 24) {
                hourlyData[hour].total++;
                if (med.taken) {
                    hourlyData[hour].taken++;
                }
            }
        });
        
        // Create labels (12AM, 1AM, ... 11PM)
        const labels = [];
        const takenData = [];
        
        for (let hour = 0; hour < 24; hour++) {
            let label;
            if (hour === 0) label = '12AM';
            else if (hour < 12) label = hour + 'AM';
            else if (hour === 12) label = '12PM';
            else label = (hour - 12) + 'PM';
            
            labels.push(label);
            takenData.push(hourlyData[hour].taken);
        }
        
        dailyChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Medicines Taken',
                    data: takenData,
                    backgroundColor: '#00f2fe',
                    borderColor: '#00f2fe',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1, color: 'white' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    x: {
                        ticks: { color: 'white', maxRotation: 45, minRotation: 45 },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                },
                plugins: {
                    legend: { labels: { color: 'white' } }
                }
            }
        });
    }

    function loadWeeklyRecords() {
        // Display weekly medicine summary
        const weeklyList = document.getElementById('weeklyMedicineList');
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        let html = '<h4>Weekly Summary</h4>';
        
        // Group by medicine
        const medicineSummary = {};
        medList.forEach(med => {
            if (!medicineSummary[med.name]) {
                medicineSummary[med.name] = {
                    dosage: med.dosage,
                    times: [],
                    taken: 0,
                    total: 0
                };
            }
            medicineSummary[med.name].times.push(med.time);
            medicineSummary[med.name].total++;
            if (med.taken) medicineSummary[med.name].taken++;
        });
        
        for (let [name, data] of Object.entries(medicineSummary)) {
            html += `
                <div class="medicine-record">
                    <strong>${name}</strong> ${data.dosage ? '(' + data.dosage + ')' : ''}<br>
                    Times: ${data.times.join(', ')}<br>
                    Adherence: ${Math.round((data.taken / data.total) * 100)}% (${data.taken}/${data.total} taken)
                </div>
            `;
        }
        
        if (medList.length === 0) {
            html += '<p>No medicines added this week</p>';
        }
        
        weeklyList.innerHTML = html;
        
        // Create weekly chart
        const ctx = document.getElementById('weeklyRecordChart').getContext('2d');
        if (weeklyRecordChartInstance) weeklyRecordChartInstance.destroy();
        
        const adherenceByDay = [];
        for (let i = 0; i < 7; i++) {
            const dayMeds = medList.filter((_, index) => index % 7 === i);
            const taken = dayMeds.filter(m => m.taken).length;
            const percentage = dayMeds.length === 0 ? 0 : Math.round((taken / dayMeds.length) * 100);
            adherenceByDay.push(percentage);
        }
        
        weeklyRecordChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: days,
                datasets: [{
                    label: 'Adherence %',
                    data: adherenceByDay,
                    backgroundColor: '#00f2fe'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, max: 100, ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                         x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } } },
                plugins: { legend: { labels: { color: 'white' } } }
            }
        });
    }

    // ========== PRESCRIPTION FUNCTIONS - EXTRACT ALL FROM UPLOAD ==========
    function loadPrescriptions() {
      const saved = localStorage.getItem('prescriptions');
      if (saved) {
        prescriptions = JSON.parse(saved);
        displayAllPrescriptions();
      }
    }

    function extractPrescriptionInfo() {
      const fileInput = document.getElementById('prescriptionUpload');
      const file = fileInput.files[0];
      
      if (!file) {
          alert('‚ùå Please select a prescription file');
          return;
      }
      
      alert('üìÑ Processing prescription... Extracting all details...');
      
      // Simulate OCR extraction - In real app, this would call an API
      // This simulates extracting doctor name, date, and medicines from the prescription image
      
      // Sample doctor names for simulation
      const doctorNames = [
          'Dr. Sarah Johnson', 'Dr. Michael Chen', 'Dr. Emily Williams', 
          'Dr. James Wilson', 'Dr. Maria Garcia', 'Dr. Robert Brown',
          'Dr. Lisa Anderson', 'Dr. David Lee', 'Dr. Patricia Martinez'
      ];
      
      // Sample dates (within last 30 days)
      const today = new Date();
      const randomDaysAgo = Math.floor(Math.random() * 30);
      const prescriptionDate = new Date(today);
      prescriptionDate.setDate(today.getDate() - randomDaysAgo);
      const dateStr = prescriptionDate.toISOString().split('T')[0];
      
      // Medicine database with realistic prescriptions
      const medicineDatabase = [
          { name: 'Paracetamol', dosage: '500mg', frequency: '3 times daily', duration: 5, instructions: 'Take after meals' },
          { name: 'Amoxicillin', dosage: '500mg', frequency: '3 times daily', duration: 7, instructions: 'Complete full course' },
          { name: 'Ibuprofen', dosage: '400mg', frequency: 'twice daily', duration: 3, instructions: 'Take with food' },
          { name: 'Azithromycin', dosage: '250mg', frequency: 'once daily', duration: 5, instructions: 'Take on empty stomach' },
          { name: 'Metformin', dosage: '500mg', frequency: 'twice daily', duration: 30, instructions: 'Take with meals' },
          { name: 'Amlodipine', dosage: '5mg', frequency: 'once daily', duration: 30, instructions: 'Take in morning' },
          { name: 'Omeprazole', dosage: '20mg', frequency: 'once daily', duration: 14, instructions: 'Take before breakfast' },
          { name: 'Cetirizine', dosage: '10mg', frequency: 'once daily', duration: 7, instructions: 'Take at night' },
          { name: 'Vitamin D3', dosage: '1000 IU', frequency: 'once daily', duration: 30, instructions: 'Take with food' },
          { name: 'Levothyroxine', dosage: '75mcg', frequency: 'once daily', duration: 30, instructions: 'Take on empty stomach' },
          { name: 'Losartan', dosage: '50mg', frequency: 'once daily', duration: 30, instructions: 'Take same time daily' },
          { name: 'Atorvastatin', dosage: '20mg', frequency: 'once daily', duration: 30, instructions: 'Take in evening' }
      ];
      
      // Randomly select a doctor
      const randomDoctor = doctorNames[Math.floor(Math.random() * doctorNames.length)];
      
      // Randomly select 2-5 medicines for this prescription
      const numMeds = Math.floor(Math.random() * 4) + 2; // 2-5 medicines
      const shuffled = [...medicineDatabase].sort(() => 0.5 - Math.random());
      const selectedMeds = shuffled.slice(0, numMeds);
      
      // Display extracted information
      const previewDiv = document.getElementById('extractedPreview');
      const doctorInfoDiv = document.getElementById('extractedDoctorInfo');
      const dateInfoDiv = document.getElementById('extractedDateInfo');
      const medsListDiv = document.getElementById('extractedMedicinesList');
      
      // Show doctor info
      doctorInfoDiv.innerHTML = `
          <p><strong>Name:</strong> ${randomDoctor}</p>
          <p><strong>License:</strong> MED-${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</p>
          <p><strong>Clinic:</strong> ${['City Medical Center', 'HealthFirst Clinic', 'Community Hospital', 'Wellness Care'][Math.floor(Math.random() * 4)]}</p>
      `;
      
      // Show date info
      const formattedDate = prescriptionDate.toLocaleDateString('en-US', { 
          weekday: 'long', 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
      });
      dateInfoDiv.innerHTML = `<p><strong>Prescribed on:</strong> ${formattedDate}</p>`;
      
      // Show medicines with duration
      let medsHtml = '';
      selectedMeds.forEach((med) => {
          const startDate = new Date(prescriptionDate);
          const endDate = new Date(startDate);
          endDate.setDate(endDate.getDate() + med.duration);
          
          medsHtml += `
              <div style="background: rgba(255,255,255,0.1); margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                      <strong style="color: #2ecc71; font-size: 1.1rem;">${med.name}</strong>
                      <span style="background: #2ecc71; color: #000; padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">${med.duration} days</span>
                  </div>
                  <p style="margin: 5px 0;"><strong>Dosage:</strong> ${med.dosage}</p>
                  <p style="margin: 5px 0;"><strong>Frequency:</strong> ${med.frequency}</p>
                  <p style="margin: 5px 0;"><strong>Instructions:</strong> ${med.instructions}</p>
                  <p style="margin: 5px 0; color: #f39c12;"><strong>Schedule:</strong> ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}</p>
              </div>
          `;
      });
      
      medsListDiv.innerHTML = medsHtml;
      previewDiv.style.display = 'block';
      
      // Store all extracted data
      window.currentPrescriptionData = {
          doctorName: randomDoctor,
          doctorInfo: {
              license: `MED-${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}`,
              clinic: ['City Medical Center', 'HealthFirst Clinic', 'Community Hospital', 'Wellness Care'][Math.floor(Math.random() * 4)]
          },
          date: dateStr,
          formattedDate: formattedDate,
          fileName: file.name,
          medicines: selectedMeds
      };
    }

    function confirmExtractedMeds() {
      if (!window.currentPrescriptionData) {
          alert('No prescription data to confirm');
          return;
      }
      
      const data = window.currentPrescriptionData;
      const prescriptionId = Date.now();
      const startDate = new Date(data.date);
      const medicineSchedules = [];
      
      data.medicines.forEach(med => {
          // Set times based on frequency
          let times = [];
          if (med.frequency.includes('3 times')) {
              times = ['08:00', '14:00', '20:00'];
          } else if (med.frequency.includes('twice')) {
              times = ['08:00', '20:00'];
          } else {
              times = ['08:00'];
          }
          
          // Add for each day of duration
          for (let day = 0; day < med.duration; day++) {
              const currentDate = new Date(startDate);
              currentDate.setDate(startDate.getDate() + day);
              const dateStr = currentDate.toISOString().split('T')[0];
              
              times.forEach(time => {
                  medicineSchedules.push({
                      name: med.name,
                      dosage: med.dosage,
                      time: time,
                      date: dateStr,
                      taken: false,
                      reminded: false,
                      lastReminder: null,
                      prescription: prescriptionId,
                      frequency: med.frequency,
                      instructions: med.instructions
                  });
              });
          }
      });
      
      // Save complete prescription with all details
      const prescription = {
          id: prescriptionId,
          doctorName: data.doctorName,
          doctorInfo: data.doctorInfo,
          date: data.date,
          formattedDate: data.formattedDate,
          fileName: data.fileName,
          medicines: data.medicines,
          medicineSchedules: medicineSchedules,
          addedDate: new Date().toISOString(),
          totalDoses: medicineSchedules.length
      };
      
      prescriptions.push(prescription);
      localStorage.setItem('prescriptions', JSON.stringify(prescriptions));
      
      // Add all scheduled medicines to main list
      medicineSchedules.forEach(schedule => {
          medList.push(schedule);
      });
      
      localStorage.setItem('medicines', JSON.stringify(medList));
      updateMedList();
      
      // Hide preview and clear input
      document.getElementById('extractedPreview').style.display = 'none';
      document.getElementById('prescriptionUpload').value = '';
      
      displayAllPrescriptions();
      
      const totalDays = data.medicines.reduce((sum, m) => sum + m.duration, 0);
      alert(`‚úÖ Prescription from ${data.doctorName} added!\n‚Ä¢ ${data.medicines.length} medicines\n‚Ä¢ ${medicineSchedules.length} total doses\n‚Ä¢ Scheduled for next ${totalDays} days`);
    }

    function displayAllPrescriptions() {
      const container = document.getElementById('prescriptionsList');
      if (!container) return;
      
      if (prescriptions.length === 0) {
          container.innerHTML = '<p style="text-align: center; padding: 20px;">No prescriptions added yet. Upload your first prescription above.</p>';
          return;
      }
      
      let html = '';
      
      // Sort by date (newest first)
      prescriptions.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      prescriptions.forEach((pres, index) => {
          const addedDate = new Date(pres.addedDate).toLocaleDateString();
          
          html += `
              <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2);">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                      <h4 style="color: #00f2fe; margin: 0;">Prescription #${prescriptions.length - index}</h4>
                      <small style="color: rgba(255,255,255,0.6);">Added: ${addedDate}</small>
                  </div>
                  
                  <!-- Doctor Details -->
                  <div style="background: rgba(52, 152, 219, 0.2); border-radius: 8px; padding: 10px; margin: 10px 0;">
                      <p style="margin: 3px 0;"><strong style="color: #3498db;">üë®‚Äç‚öïÔ∏è Doctor:</strong> ${pres.doctorName}</p>
                      <p style="margin: 3px 0;"><strong style="color: #3498db;">üìã License:</strong> ${pres.doctorInfo.license}</p>
                      <p style="margin: 3px 0;"><strong style="color: #3498db;">üè• Clinic:</strong> ${pres.doctorInfo.clinic}</p>
                  </div>
                  
                  <!-- Prescription Date -->
                  <div style="background: rgba(155, 89, 182, 0.2); border-radius: 8px; padding: 10px; margin: 10px 0;">
                      <p style="margin: 3px 0;"><strong style="color: #9b59b6;">üìÖ Prescribed on:</strong> ${pres.formattedDate}</p>
                  </div>
                  
                  <!-- Medicines -->
                  <div style="background: rgba(46, 204, 113, 0.2); border-radius: 8px; padding: 10px; margin: 10px 0;">
                      <p style="margin: 0 0 8px 0;"><strong style="color: #2ecc71;">üíä Prescribed Medicines:</strong></p>
          `;
          
          pres.medicines.forEach(med => {
              html += `
                  <div style="background: rgba(255,255,255,0.1); margin: 8px 0; padding: 8px; border-radius: 5px;">
                      <div style="display: flex; justify-content: space-between;">
                          <span><strong>${med.name}</strong> ${med.dosage}</span>
                          <span style="background: #2ecc71; color: #000; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${med.duration} days</span>
                      </div>
                      <p style="margin: 3px 0; font-size: 0.9rem;">${med.frequency} - ${med.instructions}</p>
                  </div>
              `;
          });
          
          html += `
                  </div>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                      <span style="font-size: 0.9rem;">üìä ${pres.totalDoses} total doses scheduled</span>
                      <button onclick="viewPrescriptionDetails(${pres.id})" style="background: #00f2fe; color: #000; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer; font-size: 0.9rem;">
                          View Details
                      </button>
                  </div>
              </div>
          `;
      });
      
      container.innerHTML = html;
    }

    function viewPrescriptionDetails(prescriptionId) {
      const prescription = prescriptions.find(p => p.id === prescriptionId);
      if (!prescription) return;
      
      let details = `üìã PRESCRIPTION DETAILS\n\n`;
      details += `üë®‚Äç‚öïÔ∏è Doctor: ${prescription.doctorName}\n`;
      details += `üè• Clinic: ${prescription.doctorInfo.clinic}\n`;
      details += `üìÖ Date: ${prescription.formattedDate}\n\n`;
      details += `üíä MEDICINES:\n`;
      
      prescription.medicines.forEach((med, i) => {
          details += `${i+1}. ${med.name} ${med.dosage}\n`;
          details += `   ‚Ä¢ Frequency: ${med.frequency}\n`;
          details += `   ‚Ä¢ Duration: ${med.duration} days\n`;
          details += `   ‚Ä¢ Instructions: ${med.instructions}\n\n`;
      });
      
      details += `üìä Total Doses: ${prescription.totalDoses}`;
      
      alert(details);
    }

    // ========== CORE MEDICINE FUNCTIONS ==========
    function addMedicine() {
        const name = document.getElementById("medName").value;
        const dosage = document.getElementById("medDosage").value;
        const time = document.getElementById("medTime").value;
        if (!name || !time) { alert("Please fill the medicine name and time!"); return; }
        medList.push({ name, dosage, time, taken: false, reminded: false, lastReminder: null });
        localStorage.setItem("medicines", JSON.stringify(medList));
        updateMedList();
        document.getElementById("medName").value = "";
        document.getElementById("medDosage").value = "";
        document.getElementById("medTime").value = "";
    }

    function updateMedList() {
        const ul = document.getElementById("medList");
        if (!ul) return;
        ul.innerHTML = "";
        medList.forEach((med, index) => {
            const li = document.createElement("li");
            li.innerHTML = `<span>${med.name} - ${med.time} ${med.dosage ? ' ('+med.dosage+')' : ''} ${med.date ? ' ['+med.date+']' : ''}</span> 
                            <input type="checkbox" ${med.taken ? "checked" : ""} onchange="toggleTaken(${index})">`;
            if (med.taken) li.style.background = "#c8e6c9";
            ul.appendChild(li);
        });
        updateProgress();
    }

    function updateProgress() {
        const today = new Date().toISOString().split('T')[0];
        const todayMeds = medList.filter(med => !med.date || med.date === today);
        const total = todayMeds.length;
        const taken = todayMeds.filter(med => med.taken).length;
        const percentage = total === 0 ? 0 : Math.round((taken / total) * 100);
        const scoreEl = document.getElementById("healthScore");
        if (scoreEl) scoreEl.innerText = `Today's Adherence: ${percentage}%`;
        const bar = document.getElementById("progressBar");
        if (bar) bar.style.width = percentage + "%";
        saveDailyAdherence(percentage);
    }

    function highlightTaken(index) {
        const ul = document.getElementById("medList");
        if (ul && ul.children[index]) {
            ul.children[index].classList.add("highlight");
            setTimeout(() => ul.children[index].classList.remove("highlight"), 1500);
        }
    }

    function clearAll() {
        medList = [];
        localStorage.setItem("medicines", JSON.stringify(medList));
        updateMedList();
    }

    function toggleElderMode() {
        const container = document.getElementById("mainContainer");
        container.classList.toggle("elder-mode");
        const btn = document.getElementById("elderBtn");
        if (container.classList.contains("elder-mode")) {
            btn.innerText = "üëì Disable Elder Mode";
        } else {
            btn.innerText = "üëì Enable Elder Mode";
        }
    }

    function startVoice() {
        if (!('webkitSpeechRecognition' in window)) { alert("Voice recognition not supported in this browser!"); return; }
        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'en-US';
        recognition.start();
        recognition.onresult = function(event) {
            const speech = event.results[0][0].transcript.trim();
            console.log("Heard:", speech);
            const regex = /(.+?)\s*(\d+\s*(?:mg|ml|g)?)?\s*at\s*(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i;
            const match = speech.match(regex);
            if (match) {
                const medName = match[1].trim();
                const dosage = match[2] ? match[2].trim() : "";
                let hours = parseInt(match[3]);
                const minutes = match[4] ? parseInt(match[4]) : 0;
                const meridiem = match[5] ? match[5].toLowerCase() : null;
                if (meridiem) { if (meridiem === "pm" && hours < 12) hours += 12; if (meridiem === "am" && hours === 12) hours = 0; }
                const hh = hours.toString().padStart(2, "0");
                const mm = minutes.toString().padStart(2, "0");
                const medTime = `${hh}:${mm}`;
                document.getElementById("medName").value = medName;
                document.getElementById("medDosage").value = dosage;
                document.getElementById("medTime").value = medTime;
                alert(`Medicine: ${medName}\nDosage: ${dosage || "N/A"}\nTime: ${medTime}\nNow click "Add Medicine"`);
            } else {
                alert("Couldn't understand. Please say: MedicineName [Dosage] at HH[:MM] [AM/PM]");
            }
        };
        recognition.onerror = function() { alert("Voice recognition failed. Try again."); };
    }

    function toggleTaken(index) {
        medList[index].taken = !medList[index].taken;
        localStorage.setItem("medicines", JSON.stringify(medList));
        updateMedList();
    }

    // ========== REMINDER ENGINE ==========
    function checkReminders() {
        const now = new Date();
        const today = now.toISOString().split('T')[0];
        const currentSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
        
        medList.forEach((med, index) => {
            if (!med.time) return;
            if (med.date && med.date !== today) return;
            
            const timeParts = med.time.split(":");
            const medSeconds = parseInt(timeParts[0]) * 3600 + parseInt(timeParts[1]) * 60;
            
            if (!med.taken && !med.reminded && Math.abs(currentSeconds - medSeconds) <= 60) {
                if (Notification.permission === "granted") { 
                    new Notification("Medicine Reminder", { body: `Time to take ${med.name}` }); 
                }
                const speech = new SpeechSynthesisUtterance(`Time to take ${med.name}`);
                window.speechSynthesis.speak(speech);
                med.reminded = true;
                med.lastReminder = currentSeconds;
                localStorage.setItem("medicines", JSON.stringify(medList));
            }
            if (med.taken) { med.reminded = false; }
        });
    }
    setInterval(checkReminders, 1000);

    // ========== ADHERENCE HISTORY ==========
    function saveDailyAdherence(percent) {
        const today = new Date().toLocaleDateString();
        let history = JSON.parse(localStorage.getItem("adherenceHistory")) || {};
        history[today] = percent;
        localStorage.setItem("adherenceHistory", JSON.stringify(history));
    }

    // ========== WEEKLY CHART ==========
    function loadWeeklyChart() {
        const ctx = document.getElementById("weeklyChart")?.getContext("2d");
        if (!ctx) return;
        if (weeklyChartInstance) weeklyChartInstance.destroy();
        const dates = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
        const values = [80,100,60,90,70,100,50];
        weeklyChartInstance = new Chart(ctx, {
            type: "bar",
            data: { labels: dates, datasets: [{ label: "Adherence %", data: values }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100 } } }
        });
    }

    // ========== DASHBOARD TYPING ==========
    const quotes = [
        "Where science meets compassion, healing begins.",
        "A dose on time keeps worries away.",
        "Your health, our responsibility.",
        "Because every heartbeat matters."
    ];
    let qIndex = 0, charIndex = 0;
    const quoteBox = document.getElementById("dashboard-quote");
    function typeQuote() {
        if (!quoteBox) return;
        if (charIndex < quotes[qIndex].length) {
            quoteBox.innerHTML += quotes[qIndex].charAt(charIndex);
            charIndex++;
            setTimeout(typeQuote, 60);
        } else { setTimeout(nextQuote, 5000); }
    }
    function nextQuote() {
        if (!quoteBox) return;
        quoteBox.innerHTML = "";
        charIndex = 0;
        qIndex = (qIndex + 1) % quotes.length;
        typeQuote();
    }
    function checkDashboardAndStart() {
        if (document.getElementById('dashboard-page').classList.contains('active') && !dashboardActive) {
            dashboardActive = true;
            if (quoteBox) { quoteBox.innerHTML = ""; charIndex = 0; qIndex = 0; typeQuote(); }
        } else if (!document.getElementById('dashboard-page').classList.contains('active')) { dashboardActive = false; }
    }
    setInterval(checkDashboardAndStart, 500);

    // ========== PAGE SWITCHING ==========
    function switchPage(pageName, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageName + '-page').classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        if (element) element.classList.add('active');
        if (pageName === 'dashboard') { 
            dashboardActive = false; 
            updateMedList(); 
        }
        if (pageName === 'contacts') {
            displayContacts();
        }
        if (pageName === 'records') {
            loadDailyRecords();
        }
        if (pageName === 'info') { 
            displayAllPrescriptions(); 
        }
    }

    // ========== LOGIN ==========
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('register-link')?.addEventListener('click', () => alert('Redirect to registration page - feature coming soon!'));
        document.getElementById('loginButton')?.addEventListener('click', function() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if ("Notification" in window) {
                Notification.requestPermission();
            }
            
            if (username && password) {
                alert('Login successful! (Demo)');
                switchPage('dashboard', document.querySelectorAll('.tab-btn')[2]);
            } else { 
                alert('Please enter username and password'); 
            }
        });
    });

    // Add file input change listener
    document.getElementById('prescriptionUpload').addEventListener('change', extractPrescriptionInfo);

    // ========== EXPOSE GLOBAL FUNCTIONS ==========
    window.switchPage = switchPage;
    window.addMedicine = addMedicine;
    window.clearAll = clearAll;
    window.toggleElderMode = toggleElderMode;
    window.startVoice = startVoice;
    window.toggleTaken = toggleTaken;
    window.loadWeeklyChart = loadWeeklyChart;
    window.addContact = addContact;
    window.removeContact = removeContact;
    window.displayContacts = displayContacts;
    window.toggleSideMenu = toggleSideMenu;
    window.sendMessage = sendMessage;
    window.showRecordTab = showRecordTab;
    window.extractPrescriptionInfo = extractPrescriptionInfo;
    window.confirmExtractedMeds = confirmExtractedMeds;
    window.displayAllPrescriptions = displayAllPrescriptions;
    window.viewPrescriptionDetails = viewPrescriptionDetails;
    window.toggleCustomGateway = toggleCustomGateway;
    window.sendWhatsAppSOS = sendWhatsAppSOS;
    window.saveSOSLog = saveSOSLog;
  </script>
</body>
</html>